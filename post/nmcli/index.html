<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>openEuler配置网路 | 张益铭的博客</title>
<meta name="description" content="子非鱼,安知鱼之乐?
子非我,安知我不知鱼之乐?">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://zhangyiming748.github.io/favicon.ico?v=1745160053425">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zhangyiming748.github.io/styles/main.css">


  

  
    <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css" />
  

<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141755803-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-141755803-1');
</script>


  </head>
  <body>
  
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://zhangyiming748.github.io">张益铭的博客</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                首页
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/test" class="menu">
                长期测试
              </a>
            
          </li>
        
          <li>
            
              <a href="https://yeasy.gitbook.io/docker_practice/" class="menu" target="_blank">
                docker
              </a>
            
          </li>
        
          <li>
            
              <a href="https://mirrors.tuna.tsinghua.edu.cn/" class="menu" target="_blank">
                清华源
              </a>
            
          </li>
        
          <li>
            
              <a href="https://appstorrent.ru/" class="menu" target="_blank">
                mac软件
              </a>
            
          </li>
        
          <li>
            
              <a href="https://api.lolimi.cn/API/cosplay/api.php?type=image" class="menu" target="_blank">
                手气不错
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/anime" class="menu">
                下载队列
              </a>
            
          </li>
        
          <li>
            
              <a href="https://linux.do/" class="menu" target="_blank">
                Linux.do
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>openEuler配置网路</h1>
            <p class="article-meta">
              2022-09-26
              
                <a href="https://zhangyiming748.github.io/tag/pmLBkvrEV/" class="badge success">
                  openEuler
                </a>
              
                <a href="https://zhangyiming748.github.io/tag/whd1tmbG7/" class="badge secondary">
                  Linux
                </a>
              
            </p>
            
            <div class="post-content" v-pre>
              <h1 id="配置网络">配置网络</h1>
<!-- TOC -->
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C">配置网络</a>
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE-ip">配置 IP</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8nmcli%E5%91%BD%E4%BB%A4">使用nmcli命令</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8ip%E5%91%BD%E4%BB%A4">使用ip命令</a></li>
<li><a href="#%E9%80%9A%E8%BF%87ifcfg%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C">通过ifcfg文件配置网络</a></li>
</ul>
</li>
<li><a href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D">配置主机名</a>
<ul>
<li><a href="#%E7%AE%80%E4%BB%8B">简介</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8hostnamectl%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D">使用hostnamectl配置主机名</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8nmcli%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D">使用nmcli配置主机名</a></li>
</ul>
</li>
<li><a href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E7%BB%91%E5%AE%9A">配置网络绑定</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8nmcli">使用nmcli</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C">使用命令行</a></li>
</ul>
</li>
<li><a href="#ipv6%E4%BD%BF%E7%94%A8%E5%B7%AE%E5%BC%82%E8%AF%B4%E6%98%8Evs-ipv4">IPv6使用差异说明(vs IPv4)</a>
<ul>
<li><a href="#%E7%BA%A6%E6%9D%9F%E9%99%90%E5%88%B6">约束限制</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">配置说明</a></li>
<li><a href="#faq">FAQ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="配置-ip">配置 IP</h2>
<h3 id="使用nmcli命令">使用nmcli命令</h3>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
使用nmcli命令配置的网络配置可以立即生效且系统重启后配置也不会丢失.</p>
</blockquote>
<h4 id="nmcli介绍">nmcli介绍</h4>
<p>nmcli是NetworkManager的一个命令行工具,它提供了使用命令行配置由NetworkManager管理网络连接的方法.nmcli命令的基本格式为:</p>
<pre><code> nmcli [OPTIONS] OBJECT { COMMAND | help }
</code></pre>
<p>其中,OBJECT选项可以是general\networking\radio\connection或device等.在日常使用中,最常使用的是-t, --terse(用于脚本)-p, --pretty选项(用于用户)及-h, --help选项,用户可以使用&quot; nmcli help&quot;获取更多参数及使用信息.</p>
<pre><code>$ nmcli help
</code></pre>
<p>常用命令使用举例如下:</p>
<ul>
<li>
<p>显示NetworkManager状态:</p>
<pre><code>$ nmcli general status
</code></pre>
</li>
<li>
<p>显示所有连接:</p>
<pre><code>$ nmcli connection show
</code></pre>
</li>
<li>
<p>只显示当前活动连接,如下所示添加 -a, --active:</p>
<pre><code>$ nmcli connection show --active
</code></pre>
</li>
<li>
<p>显示由NetworkManager识别到设备及其状态:</p>
<pre><code>$ nmcli device status
</code></pre>
</li>
<li>
<p>使用nmcli工具启动和停止网络接口,在root权限下执行如下命令:</p>
<pre><code># nmcli connection up id enp3s0
# nmcli device disconnect enp3s0
</code></pre>
</li>
</ul>
<h4 id="设备管理">设备管理</h4>
<h5 id="连接到设备">连接到设备</h5>
<p>使用如下命令,NetworkManager将连接到对应网络设备,尝试找到合适的连接配置,并激活配置.</p>
<pre><code>$nmcli device connect &quot;$IFNAME&quot;  
</code></pre>
<blockquote>
<p>如果不存在相应的配置连接,NetworkManager将创建并激活具有默认设置的新配置文件.</p>
</blockquote>
<h5 id="断开设备连接">断开设备连接</h5>
<p>使用如下命令,NetworkManager将断开设备连接,并防止设备自动激活.</p>
<pre><code>$nmcli device disconnect &quot;$IFNAME&quot;  
</code></pre>
<h4 id="设置网络连接">设置网络连接</h4>
<p>列出目前可用的网络连接:</p>
<pre><code>$ nmcli con show


NAME    UUID                                  TYPE      DEVICE
enp4s0  5afce939-400e-42fd-91ee-55ff5b65deab  ethernet  enp4s0
enp3s0  c88d7b69-f529-35ca-81ab-aa729ac542fd  ethernet  enp3s0
virbr0  ba552da6-f014-49e3-91fa-ec9c388864fa  bridge    virbr0
</code></pre>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
输出结果中的NAME字段代表连接ID(名称).</p>
</blockquote>
<p>添加一个网络连接会生成相应的配置文件,并与相应的设备关联.检查可用的设备,方法如下:</p>
<pre><code>$ nmcli dev status

DEVICE      TYPE      STATE      CONNECTION
enp3s0      ethernet  connected  enp3s0
enp4s0      ethernet  connected  enp4s0
virbr0      bridge    connected  virbr0
lo          loopback  unmanaged  --
virbr0-nic  tun       unmanaged  --
</code></pre>
<h5 id="配置动态ip连接">配置动态IP连接</h5>
<h6 id="配置ip">配置IP</h6>
<p>要使用 DHCP 分配网络时,可以使用动态IP配置添加网络配置文件,命令格式如下:</p>
<pre><code>nmcli connection add type ethernet con-name connection-name ifname interface-name
</code></pre>
<p>例如创建名为net-test的动态连接配置文件,在root权限下使用以下命令:</p>
<pre><code># nmcli connection add type ethernet con-name net-test ifname enp3s0
Connection 'net-test' (a771baa0-5064-4296-ac40-5dc8973967ab) successfully added.
</code></pre>
<p>NetworkManager 会将参数 connection.autoconnect 设定为 yes,并将设置保存到 &quot;/etc/sysconfig/network-scripts/ifcfg-net-test&quot;文件中,在该文件中会将 ONBOOT 设置为 yes.</p>
<h6 id="激活连接并检查状态">激活连接并检查状态</h6>
<p>在root权限下使用以下命令激活网络连接:</p>
<pre><code># nmcli con up net-test 
Connection successfully activated (D-Bus active path:/org/freedesktop/NetworkManager/ActiveConnection/5)
</code></pre>
<p>检查这些设备及连接的状态,使用以下命令:</p>
<pre><code>$ nmcli device status

DEVICE      TYPE      STATE      CONNECTION
enp4s0      ethernet  connected  enp4s0
enp3s0      ethernet  connected  net-test
virbr0      bridge    connected  virbr0
lo          loopback  unmanaged  --
virbr0-nic  tun       unmanaged  --
</code></pre>
<h5 id="配置静态ip连接">配置静态IP连接</h5>
<h6 id="配置ip-2">配置IP</h6>
<p>添加静态 IPv4 配置的网络连接,可使用以下命令:</p>
<pre><code>nmcli connection add type ethernet con-name connection-name ifname interface-name ip4 address gw4 address
</code></pre>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
如果要添加 IPv6 地址和网关信息,使用 ip6 和 gw6 选项.</p>
</blockquote>
<p>例如创建名为 net-static的静态连接配置文件,在root权限下使用以下命令:</p>
<pre><code># nmcli con add type ethernet con-name net-static ifname enp3s0 ip4 192.168.0.10/24 gw4 192.168.0.254
</code></pre>
<p>还可为该设备同时指定 IPv6 地址和网关,示例如下:</p>
<pre><code># nmcli con add type ethernet con-name test-lab ifname enp3s0 ip4 192.168.0.10/24 gw4 192.168.0.254 ip6 abbe::**** gw6 2001:***::*
Connection 'net-static' (63aa2036-8665-f54d-9a92-c3035bad03f7) successfully added.
</code></pre>
<p>NetworkManager 会将其内部参数 ipv4.method 设定为 manual,将 connection.autoconnect 设定为yes,并将设置写入 /etc/sysconfig/network-scripts/ifcfg-my-office 文件,其中会将对应 BOOTPROTO 设定为 none,将 ONBOOT 设定为 yes.</p>
<p>设定两个 IPv4 DNS 服务器地址,在root权限下使用以下命令:</p>
<pre><code># nmcli con mod net-static ipv4.dns &quot;*.*.*.* *.*.*.*&quot;
</code></pre>
<p>设置两个 IPv6 DNS 服务器地址,在root权限下使用以下命令:</p>
<pre><code># nmcli con mod net-static ipv6.dns &quot;2001:4860:4860::**** 2001:4860:4860::****&quot;
</code></pre>
<h6 id="激活连接并检查状态-2">激活连接并检查状态</h6>
<p>激活新的网络连接,在root权限下使用以下命令:</p>
<pre><code># nmcli con up net-static ifname enp3s0
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/6)
</code></pre>
<p>检查这些设备及连接的状态,使用以下命令:</p>
<pre><code>$ nmcli device status

DEVICE      TYPE      STATE      CONNECTION
enp4s0      ethernet  connected  enp4s0
enp3s0      ethernet  connected  net-static
virbr0      bridge    connected  virbr0
lo          loopback  unmanaged  --
virbr0-nic  tun       unmanaged  --
</code></pre>
<p>查看配置的连接详情,使用以下命令(使用 -p, --pretty 选项在输出结果中添加标题和分段):</p>
<pre><code>$ nmcli -p con show net-static 
===============================================================================
Connection profile details (net-static )
===============================================================================
connection.id:                          net-static
connection.uuid:                        b9f18801-6084-4aee-af28-c8f0598ff5e1
connection.stable-id:                   --
connection.type:                        802-3-ethernet
connection.interface-name:              enp3s0
connection.autoconnect:                 yes
connection.autoconnect-priority:        0
connection.autoconnect-retries:         -1 (default)
connection.multi-connect:               0 (default)
connection.auth-retries:                -1
connection.timestamp:                   1578988781
connection.read-only:                   no
connection.permissions:                 --
connection.zone:                        --
connection.master:                      --
connection.slave-type:                  --
connection.autoconnect-slaves:          -1 (default)
connection.secondaries:                 --
connection.gateway-ping-timeout:        0
connection.metered:                     unknown
connection.lldp:                        default
connection.mdns:                        -1 (default)
connection.llmnr:                       -1 (default)
</code></pre>
<h5 id="添加-wi-fi-连接">添加 Wi-Fi 连接</h5>
<p>有两种方式添加Wi-Fi 连接.</p>
<p><strong>方法1,通过网络接口连接wifi</strong></p>
<p>连接到由SSID或BSSID指定的wifi网络.命令如下,该命令找到匹配的连接或创建一个连接,然后在设备上激活它.</p>
<pre><code>$ nmcli device wifi connect &quot;$SSID&quot; password &quot;$PASSWORD&quot; ifname &quot;$IFNAME&quot;  
$ nmcli --ask device wifi connect &quot;$SSID&quot; 
</code></pre>
<p><strong>方法2,通过配置文件连接Wi-Fi</strong></p>
<p>1,使用以下命令查看可用 Wi-Fi 访问点:</p>
<pre><code>$ nmcli dev wifi list
</code></pre>
<p>2,使用以下命令生成使用的静态 IP 配置,但允许自动 DNS 地址分配的 Wi-Fi 连接:</p>
<pre><code>$ nmcli con add con-name Wifi ifname wlan0 type wifi ssid MyWifi ip4 192.168.100.101/24 gw4 192.168.100.1
</code></pre>
<p>3,请使用以下命令设定 WPA2 密码,例如 &quot;answer&quot;:</p>
<pre><code>$ nmcli con modify Wifi wifi-sec.key-mgmt wpa-psk
$ nmcli con modify Wifi wifi-sec.psk answer
</code></pre>
<p>4,使用以下命令更改 Wi-Fi 状态:</p>
<pre><code>$ nmcli radio wifi [ on | off ]
</code></pre>
<h5 id="更改属性">更改属性</h5>
<p>请使用以下命令检查具体属性,比如 mtu:</p>
<pre><code>$ nmcli connection show id 'Wifi ' | grep mtu
802-11-wireless.mtu: auto
</code></pre>
<p>使用如下命令更改设置的属性:</p>
<pre><code>$ nmcli connection modify id 'Wifi ' 802-11-wireless.mtu 1350
</code></pre>
<p>使用如下命令确认更改:</p>
<pre><code>$ nmcli connection show id 'Wifi ' | grep mtu
802-11-wireless.mtu: 1350
</code></pre>
<h4 id="配置静态路由">配置静态路由</h4>
<ul>
<li>
<p>使用nmcli命令为网络连接配置静态路由,使用命令如下:</p>
<pre><code>$ nmcli connection modify enp3s0 +ipv4.routes &quot;192.168.122.0/24 10.10.10.1&quot;
</code></pre>
</li>
<li>
<p>使用编辑器配置静态路由,使用如下命令:</p>
<pre><code>$ nmcli con edit type ethernet con-name enp3s0
===| nmcli interactive connection editor |===
Adding a new '802-3-ethernet' connection
Type 'help' or '?' for available commands.
Type 'describe [&lt;setting&gt;.&lt;prop&gt;]' for detailed property description.
You may edit the following settings: connection, 802-3-ethernet (ethernet), 802-1x, ipv4, ipv6, dcb
nmcli&gt; set ipv4.routes 192.168.122.0/24 10.10.10.1
nmcli&gt;
nmcli&gt; save persistent
Saving the connection with 'autoconnect=yes'. That might result in an immediate activation of the connection.
Do you still want to save? [yes] yes
Connection 'enp3s0' (1464ddb4-102a-4e79-874a-0a42e15cc3c0) successfully saved.
nmcli&gt; quit
</code></pre>
</li>
</ul>
<h3 id="使用ip命令">使用ip命令</h3>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
使用ip命令配置的网络配置可以立即生效但系统重启后配置会丢失.</p>
</blockquote>
<h4 id="配置ip地址">配置IP地址</h4>
<p>使用ip命令为接口配置地址,命令格式如下,其中  <em>interface-name</em>  为网卡名称.</p>
<pre><code>ip addr [ add | del ] address dev interface-name
</code></pre>
<h5 id="配置静态地址">配置静态地址</h5>
<p>在root权限下,配置设置IP地址,使用示例如下:</p>
<pre><code># ip address add 192.168.0.10/24 dev enp3s0
</code></pre>
<p>查看配置结果,在root权限使用如下命令:</p>
<pre><code># ip addr show dev enp3s0
2: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:aa:ad:4a brd ff:ff:ff:ff:ff:ff
    inet 192.168.202.248/16 brd 192.168.255.255 scope global dynamic noprefixroute enp3s0
       valid_lft 9547sec preferred_lft 9547sec
    inet 192.168.0.10/24 scope global enp3s0
       valid_lft forever preferred_lft forever
    inet6 fe80::32e8:cc22:9db2:f4d4/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
</code></pre>
<h5 id="配置多个地址">配置多个地址</h5>
<p>ip 命令支持为同一接口分配多个地址,可在root权限下重复多次使用 ip 命令实现分配多个地址.使用示例如下:</p>
<pre><code># ip address add 192.168.2.223/24 dev enp4s0
# ip address add 192.168.4.223/24 dev enp4s0
# ip addr

3: enp4s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:aa:da:e2 brd ff:ff:ff:ff:ff:ff
    inet 192.168.203.12/16 brd 192.168.255.255 scope global dynamic noprefixroute enp4s0
       valid_lft 8389sec preferred_lft 8389sec
    inet 192.168.2.223/24 scope global enp4s0
       valid_lft forever preferred_lft forever
    inet 192.168.4.223/24 scope global enp4s0
       valid_lft forever preferred_lft forever
    inet6 fe80::1eef:5e24:4b67:f07f/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
</code></pre>
<h4 id="配置静态路由-2">配置静态路由</h4>
<p>如果需要静态路由,可使用 ip route add 命令在路由表中添加,使用 ip route del 命令删除.最常使用的 ip route 命令格式如下:</p>
<pre><code>ip route [ add | del | change | append | replace ] destination-address
</code></pre>
<p>在root权限下使用 ip route 命令显示当前的 IP 路由表.示例如下:</p>
<pre><code># ip route

default via 192.168.0.1 dev enp3s0 proto dhcp metric 100
default via 192.168.0.1 dev enp4s0 proto dhcp metric 101
192.168.0.0/16 dev enp3s0 proto kernel scope link src 192.168.202.248 metric 100
192.168.0.0/16 dev enp4s0 proto kernel scope link src 192.168.203.12 metric 101
192.168.122.0/24 dev virbr0 proto kernel scope link src 192.168.122.1 linkdown
</code></pre>
<p>在主机地址中添加一个静态路由,在 root 权限下,使用以下命令格式:</p>
<pre><code>ip route add 192.168.2.1 via 10.0.0.1 [dev interface-name]
</code></pre>
<p>其中 192.168.2.1 是用点分隔的十进制符号中的 IP 地址,10.0.0.1 是下一个跃点,<em>interface-name</em>  是进入下一个跃点的退出接口.</p>
<p>要在网络中添加一个静态路由,即代表 IP 地址范围的 IP 地址,请在root权限下运行以下命令格式:</p>
<pre><code>ip route add 192.168.2.0/24 via 10.0.0.1 [dev interface-name]
</code></pre>
<p>其中 192.168.2.1 是目标网络的 IP 地址,10.0.0.1 是网络前缀,<em>interface-name</em>  为网卡名称.</p>
<h3 id="通过ifcfg文件配置网络">通过ifcfg文件配置网络</h3>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
通过ifcfg文件配置的网络配置不会立即生效,需要在root权限下执行<strong>systemctl reload NetworkManager</strong>命令以重启网络服务后才生效.</p>
</blockquote>
<h4 id="配置静态网络">配置静态网络</h4>
<p>以enp4s0网络接口进行静态网络设置为例,通过在root权限下修改ifcfg文件实现,在/etc/sysconfig/network-scripts/目录中生成名为ifcfg-enp4s0的文件中,修改参数配置,示例如下:</p>
<pre><code>TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
IPADDR=192.168.0.10
PREFIX=24
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp4s0static
UUID=08c3a30e-c5e2-4d7b-831f-26c3cdc29293
DEVICE=enp4s0
ONBOOT=yes
</code></pre>
<h4 id="配置动态网络">配置动态网络</h4>
<p>要通过ifcfg文件为em1接口配置动态网络,请按照如下操作在/etc/sysconfig/network-scripts/目录中生成名为 ifcfg-em1 的文件,示例如下:</p>
<pre><code>DEVICE=em1
BOOTPROTO=dhcp
ONBOOT=yes
</code></pre>
<p>要配置一个向DHCP服务器发送不同的主机名的接口,请在ifcfg文件中新增一行内容,如下所示:</p>
<pre><code>DHCP_HOSTNAME=hostname
</code></pre>
<p>要配置忽略由DHCP服务器发送的路由,防止网络服务使用从DHCP服务器接收的DNS服务器更新/etc/resolv.conf.请在ifcfg文件中新增一行内容,如下所示:</p>
<pre><code>PEERDNS=no
</code></pre>
<p>要配置一个接口使用具体DNS服务器,请将参数PEERDNS=no,并在ifcfg文件中添加以下行:</p>
<pre><code>DNS1=ip-address
DNS2=ip-address
</code></pre>
<p>其中ip-address是DNS服务器的地址.这样就会让网络服务使用指定的DNS服务器更新/etc/resolv.conf.</p>
<h4 id="配置默认网关">配置默认网关</h4>
<p>在确定默认网关时,首先解析 /etc/sysconfig/network 文件,然后解析 ifcfg 文件 ,将最后读取的 GATEWAY 的取值作为路由表中的默认路由.</p>
<p>在动态网络环境中,使用 NetworkManager 管理主机时,建议设置为由 DHCP 来分配.</p>
<h2 id="配置主机名">配置主机名</h2>
<h3 id="简介">简介</h3>
<p>hostname有三种类型:static\transient和pretty.</p>
<ul>
<li>static:静态主机名,可由用户自行设置,并保存在/etc/hostname 文件中.</li>
<li>transient:动态主机名,由内核维护,初始是 static 主机名,默认值为&quot;localhost&quot;.可由DHCP或mDNS在运行时更改.</li>
<li>pretty:灵活主机名,允许使用自由形式(包括特殊/空白字符)进行设置.静态/动态主机名遵从域名的通用限制.</li>
</ul>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
static和transient主机名只能包含a-z\A-Z\0-9&quot;-&quot;&quot;_&quot;和&quot;.&quot;,不能在开头或结尾处使用句点,不允许使用两个相连的句点,大小限制为 64 个字符.</p>
</blockquote>
<h3 id="使用hostnamectl配置主机名">使用hostnamectl配置主机名</h3>
<h4 id="查看所有主机名">查看所有主机名</h4>
<p>查看当前的主机名,使用如下命令:</p>
<pre><code>$ hostnamectl status
</code></pre>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
如果命令未指定任何选项,则默认使用status选项.</p>
</blockquote>
<h4 id="设定所有主机名">设定所有主机名</h4>
<p>在root权限下,设定系统中的所有主机名,使用如下命令:</p>
<pre><code># hostnamectl set-hostname name
</code></pre>
<h4 id="设定特定主机名">设定特定主机名</h4>
<p>在root权限下,通过不同的参数来设定特定主机名,使用如下命令:</p>
<pre><code># hostnamectl set-hostname name [option...]
</code></pre>
<p>其中option可以是--pretty\--static\--transient中的一个或多个选项.</p>
<p>如果--static或--transient与--pretty选项一同使用时,则会将static和transient主机名简化为pretty主机名格式,使用&quot;-&quot;替换空格,并删除特殊字符.</p>
<p>当设定pretty主机名时,如果主机名中包含空格或单引号,需要使用引号.命令示例如下:</p>
<pre><code># hostnamectl set-hostname &quot;Stephen's notebook&quot; --pretty
</code></pre>
<h4 id="清除特定主机名">清除特定主机名</h4>
<p>要清除特定主机名,并将其还原为默认形式,在root权限下,使用如下命令:</p>
<pre><code># hostnamectl set-hostname &quot;&quot; [option...]
</code></pre>
<p>其中 &quot;&quot; 是空白字符串,option是--pretty\--static和--transient中的一个或多个选项.</p>
<h4 id="远程更改主机名">远程更改主机名</h4>
<p>在远程系统中运行hostnamectl命令时,要使用-H,--host 选项,在root权限下使用如下命令:</p>
<pre><code># hostnamectl set-hostname -H [username]@hostname new_hostname
</code></pre>
<p>其中hostname是要配置的远程主机,username为自选项,new_hostname为新主机名.hostnamectl会通过SSH连接到远程系统.</p>
<h3 id="使用nmcli配置主机名">使用nmcli配置主机名</h3>
<p>查询static主机名,使用如下命令:</p>
<pre><code>$ nmcli general hostname
</code></pre>
<p>在root权限下,将static主机名设定为host-server,使用如下命令:</p>
<pre><code># nmcli general hostname host-server
</code></pre>
<p>要让系统hostnamectl感知到static主机名的更改,在root权限下,重启hostnamed服务,使用如下命令:</p>
<pre><code># systemctl restart systemd-hostnamed
</code></pre>
<h2 id="配置网络绑定">配置网络绑定</h2>
<h3 id="使用nmcli">使用nmcli</h3>
<ul>
<li>
<p>创建名为mybond0的绑定,使用示例如下:</p>
<pre><code>$ nmcli con add type bond con-name mybond0 ifname mybond0 mode active-backup
</code></pre>
</li>
<li>
<p>添加从属接口,使用示例如下:</p>
<pre><code>$ nmcli con add type bond-slave ifname enp3s0 master mybond0
</code></pre>
<p>要添加其他从属接口,重复上一个命令,并在命令中使用新的接口,使用示例如下:</p>
<pre><code>$ nmcli con add type bond-slave ifname enp4s0 master mybond0
Connection 'bond-slave-enp4s0' (05e56afc-b953-41a9-b3f9-0791eb49f7d3) successfully added.
</code></pre>
</li>
<li>
<p>要启动绑定,则必须首先启动从属接口,使用示例如下:</p>
<pre><code>$ nmcli con up bond-slave-enp3s0
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/14)
</code></pre>
<pre><code>$ nmcli con up bond-slave-enp4s0
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/15)
</code></pre>
<p>现在可以启动绑定,使用示例如下:</p>
<pre><code>$ nmcli con up mybond0
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/16)
</code></pre>
</li>
</ul>
<h3 id="使用命令行">使用命令行</h3>
<h4 id="检查是否已安装bonding内核模块">检查是否已安装Bonding内核模块</h4>
<p>在系统中默认已加载相应模块.要载入绑定模块,可在root权限下使用如下命令:</p>
<pre><code># modprobe --first-time bonding
</code></pre>
<p>显示该模块的信息,可在root权限下使用如下命令:</p>
<pre><code># modinfo bonding
</code></pre>
<p>更多命令请在root权限下使用modprobe --help查看.</p>
<h4 id="创建频道绑定接口">创建频道绑定接口</h4>
<p>要创建绑定接口,可在root权限下通过在 /etc/sysconfig/network-scripts/ 目录中创建名为 ifcfg-bondN 的文件(使用接口号码替换 N,比如 0).</p>
<p>根据要绑定接口类型的配置文件来编写相应的内容,比如网络接口.接口配置文件示例如下:</p>
<pre><code>DEVICE=bond0
NAME=bond0
TYPE=Bond
BONDING_MASTER=yes
IPADDR=192.168.1.1
PREFIX=24
ONBOOT=yes
BOOTPROTO=none
BONDING_OPTS=&quot;bonding parameters separated by spaces&quot;
</code></pre>
<h4 id="创建从属接口">创建从属接口</h4>
<p>创建频道绑定接口后,必须在从属接口的配置文件中添加 MASTER 和 SLAVE 指令.</p>
<p>例如将两个网络接口enp3s0 和 enp4s0 以频道方式绑定,其配置文件示例分别如下:</p>
<pre><code>TYPE=Ethernet
NAME=bond-slave-enp3s0
UUID=3b7601d1-b373-4fdf-a996-9d267d1cac40
DEVICE=enp3s0
ONBOOT=yes
MASTER=bond0
SLAVE=yes
</code></pre>
<pre><code>TYPE=Ethernet
NAME=bond-slave-enp4s0
UUID=00f0482c-824f-478f-9479-abf947f01c4a
DEVICE=enp4s0
ONBOOT=yes
MASTER=bond0
SLAVE=yes
</code></pre>
<h4 id="激活频道绑定">激活频道绑定</h4>
<p>要激活绑定,则需要启动所有从属接口.请在root权限下,运行以下命令:</p>
<pre><code># ifup enp3s0
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/7)
</code></pre>
<pre><code># ifup enp4s0
Connection successfully activated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/8)
</code></pre>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
对于已经处于&quot;up&quot;状态的接口,请首先使用&quot;ifdown  <em>enp3s0</em>  &quot;命令修改状态为down,其中  <em>enp3s0</em>  为实际网卡名称.</p>
</blockquote>
<p>完成后,启动所有从属接口以便启动绑定(不将其设定为 &quot;down&quot;).</p>
<p>要让 NetworkManager 感知到系统所做的修改,在每次修改后,请在root权限下,运行以下命令:</p>
<pre><code># nmcli con load /etc/sysconfig/network-scripts/ifcfg-device
</code></pre>
<p>查看绑定接口的状态,请在root权限下运行以下命令:</p>
<pre><code># ip link show

1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 52:54:00:aa:ad:4a brd ff:ff:ff:ff:ff:ff
3: enp4s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 52:54:00:aa:da:e2 brd ff:ff:ff:ff:ff:ff
4: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default qlen 1000
    link/ether 86:a1:10:fb:ef:07 brd ff:ff:ff:ff:ff:ff
5: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc fq_codel master virbr0 state DOWN mode DEFAULT group default qlen 1000
    link/ether 52:54:00:29:35:4c brd ff:ff:ff:ff:ff:ff
</code></pre>
<h4 id="创建多个绑定">创建多个绑定</h4>
<p>系统会为每个绑定创建一个频道绑定接口,包括 BONDING_OPTS 指令.使用这个配置方法可让多个绑定设备使用不同的配置.请按照以下操作创建多个频道绑定接口:</p>
<ul>
<li>创建多个 ifcfg-bondN 文件,文件中包含 BONDING_OPTS 指令,让网络脚本根据需要创建绑定接口.</li>
<li>创建或编辑要绑定的现有接口配置文件,添加 SLAVE 指令.</li>
<li>使用 MASTER 指令工具在频道绑定接口中分配要绑定的接口,即从属接口.</li>
</ul>
<p>以下是频道绑定接口配置文件示例:</p>
<pre><code>DEVICE=bondN
NAME=bondN
TYPE=Bond
BONDING_MASTER=yes
IPADDR=192.168.1.1
PREFIX=24
ONBOOT=yes
BOOTPROTO=none
BONDING_OPTS=&quot;bonding parameters separated by spaces&quot;
</code></pre>
<p>在这个示例中,使用绑定接口的号码替换 N.例如要创建两个接口,则需要使用正确的 IP 地址创建两个配置文件 ifcfg-bond0 和 ifcfg-bond1.</p>
<h2 id="ipv6使用差异说明vs-ipv4">IPv6使用差异说明(vs IPv4)</h2>
<h3 id="约束限制">约束限制</h3>
<ul>
<li>chrony支持全局地址(global address),不支持链路本地地址(link-local address).</li>
<li>Firefox支持通过http/https协议访问全局地址(global address),不支持链路本地地址(link-local address).</li>
</ul>
<h3 id="配置说明">配置说明</h3>
<h4 id="设置接口设备mtu值">设置接口设备MTU值</h4>
<h5 id="概述">概述</h5>
<p>IPv6场景中会发现整个路由路径中的最小mtu的值作为当前链接的PMTU的值,源端根据PMTU的值确定是否进行分片发送,而在整个路径中的其它设备将不再需要进行分片处理,从而可以降低中间路由设备的负载大小.其中IPv6 PMTU设置的最小值为1280.</p>
<h5 id="设置接口设备的mtu">设置接口设备的mtu</h5>
<p>如果在配置了IPv6地址的接口上设置mtu的值小于1280(IPv6 PMTU设置的最小值),则会导致该接口的IPv6地址被删除.并且无法再次添加IPv6地址.所以在IPv6场景中,对接口设备的mtu的配置一定要大于等于1280.<br>
请在root权限下运行如下命令查看具体现象:</p>
<pre><code># ip addr show enp3s0
3: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:00:62:xx:xx brd ff:ff:ff:ff:xx:xx
    inet 10.41.125.236/16 brd 10.41.255.255 scope global noprefixroute dynamic enp3s0
       valid_lft 38663sec preferred_lft 38663sec
    inet6 2001:222::2/64 scope global
       valid_lft forever preferred_lft forever
</code></pre>
<pre><code># ip link set dev enp3s0 mtu 1200
# ip addr show enp3s0
3: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1200 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:00:62:xx:xx brd ff:ff:ff:ff:xx:xx
    inet 10.41.125.236/16 brd 10.41.255.255 scope global noprefixroute dynamic enp3s0
       valid_lft 38642sec preferred_lft 38642sec
</code></pre>
<pre><code># ip addr add 2001:222::2/64 dev enp3s0
RTNETLINK answers: No buffer space available
</code></pre>
<pre><code># ip link set dev enp3s0 mtu 1500
# ip addr show enp3s0
3: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:00:62:xx:xx brd ff:ff:ff:ff:xx:xx
    inet 10.41.125.236/16 brd 10.41.255.255 scope global noprefixroute dynamic enp3s0
       valid_lft 38538sec preferred_lft 38538sec
</code></pre>
<pre><code># ip addr add 2001:222::2/64 dev enp3s0
# ip addr show enp3s0
3: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:00:62:xx:xx brd ff:ff:ff:ff:xx:xx
    inet 10.41.125.236/16 brd 10.41.255.255 scope global noprefixroute dynamic enp3s0
       valid_lft 38531sec preferred_lft 38531sec
    inet6 2001:222::2/64 scope global
       valid_lft forever preferred_lft forever
</code></pre>
<h4 id="有状态自动配置ipv6地址">有状态自动配置IPv6地址</h4>
<h5 id="概述-2">概述</h5>
<p>IPv6与IPv4都可以在root权限下通过DHCP的方式获得IP地址.IPv6地址有两种配置方式:无状态自动配置和有状态自动配置.</p>
<ul>
<li>
<p>无状态自动配置</p>
<p>不需要DHCP服务进行管理,设备根据网络RA(路由公告)获得网络前缀,或者link-local地址为固定fe80::.而接口ID则根据ifcfg配置IPV6_ADDR_GEN_MODE的具体设置来进行自动获得:</p>
<ol>
<li>IPv6_ADDR_GEN_MODE=&quot;stable-privacy&quot; 则根据设备及网络环境来确定一个随机接口ID.</li>
<li>IPv6_ADDR_GEN_MODE=&quot;EUI64&quot; 则根据设备MAC地址来确定接口ID.</li>
</ol>
</li>
<li>
<p>有状态自动配置:需要DHCP服务器进行管理分配,服从DHCPv6协议来从DHCPv6服务器端租赁IPv6地址.</p>
<p>在有状态自动配置IPv6地址时,DHCPv6服务端可以通过客户端设置的vendor class将客户端进行分类,不同类别分配不同地址段的IPv6地址.在IPv4场景中,客户端可以直接用dhclient的-V选项来设置vendor-class-identifier,DHCP服务端在配置文件中根据vendor-class-identifier来对客户端进行分类处理.而IPv6场景中,如果使用同样的方法对客户端分类,则分类并不会生效.</p>
<pre><code>dhclient -6 &lt;interface&gt; -V &lt;vendor-class-identifier string&gt; &lt;interface&gt;
</code></pre>
<p>这是由于DHCPv6和DHCP协议存在较大差异,DHCPv6的可选项中使用vendor-class-option替代了DHCP中的vendor-class-identifier.而dhclient的-V选项并不能设置vendor-class-option.</p>
</li>
</ul>
<h5 id="有状态自动配置ipv6地址时dhclient设置vendor-class方法">有状态自动配置IPv6地址时dhclient设置vendor class方法</h5>
<ul>
<li>
<p>在客户端使用配置文件方式添加对vendor class的设置,使用方法如下:</p>
<p>客户端配置文件(/etc/dhcp/dhclient6.conf),文件位置可以自定义,在使用时需要通过dhclient -cf选项来指定配置文件:</p>
<pre><code>option dhcp6.vendor-class code 16 = {integer 32, integer 16, string};
interface &quot;enp3s0&quot; {
        send dhcp6.vendor-class &lt;Enterprise-ID number&gt; &lt;vendor class string length&gt; &lt;vendor class string&gt;;
}
</code></pre>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong></p>
<ul>
<li>&lt;Enterprise-ID number&gt;,32位整型数字,企业标识号,企业通过IANA注册.</li>
<li>&lt;vendor class string length&gt;,16位整型数字,vendor class字符串长度.</li>
<li>&lt;vendor class string&gt;,要设置的vendor class字符串,例如:&quot;HWHW&quot;.</li>
</ul>
</blockquote>
<p>客户端使用方法:</p>
<pre><code>dhclient -6 &lt;interface&gt; -cf /etc/dhcp/dhclient6.conf
</code></pre>
</li>
<li>
<p>DHCPv6服务端配置文件(/etc/dhcp/dhcpd6.conf),需要dhcpd -cf选项来指定该配置文件:</p>
<pre><code>option dhcp6.vendor-class code 16 = {integer 32, integer 16, string};
subnet6 fc00:4:12:ffff::/64 {
        class &quot;hw&quot; {
                match if substring ( option dhcp6.vendor-class, 6, 10 ) = &quot;HWHW&quot;;
        }
        pool6 {
                allow members of &quot;hw&quot;;
                range6 fc00:4:12:ffff::ff10 fc00:4:12:ffff::ff20;
        }
        pool6 {
                allow unknown clients;
                range6 fc00:4:12:ffff::100 fc00:4:12:ffff::120;
        }
}
</code></pre>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
substring ( option dhcp6.vendor-class, 6, 10 ) 其中子字符串的开始位置为6,因为前面包含4个字节的&lt;Enterprise-ID number&gt;和2个字节的&lt;string length&gt;.而子字符串的结束位置位:6+&lt;vendor class string length&gt;.这里vendor class string为&quot;HWHW&quot;,字符串的长度为4,所以子字符串的结束位置为6+4=10.用户可以根据实际需要来确定&lt;vendor class string&gt;及相应的&lt;vendor class string length&gt;.</p>
</blockquote>
<p>服务端使用方法:</p>
<pre><code>dhcpd -6 -cf /etc/dhcp/dhcpd6.conf &lt;interface&gt;
</code></pre>
</li>
</ul>
<h4 id="内核支持socket相关系统调用">内核支持socket相关系统调用</h4>
<h5 id="概述-3">概述</h5>
<p>IPv6地址长度扩展到128比特,所以有足够的IPv6地址可供分配使用.同时IPv6头相比IPv4头进行了简化,并增强了IPv6的自动配置功能.IPv6地址分为单播地址,组播地址和任意播地址.常用的单播地址又包含:链路本地地址(link-local address),唯一本地地址(Unique local address)和全局地址(global address).由于IPv6的全局地址十分充足,唯一本地地址一般不被使用(其前身为站点本地地址(site-local address),已于2004年被废弃).当前主要使用的单播地址为:链路本地地址(link-local address)和全局地址(global address).当前内核支持socket系统调用,在使用单播地址的链路本地地址和全局地址时存在差异.</p>
<h5 id="link-local地址和global地址在socket调用时的差异">link-local地址和global地址在socket调用时的差异</h5>
<p>RFC 2553: Basic Socket Interface Extensions for IPv6 定义sockaddr_in6的数据结构如下;</p>
<pre><code>struct sockaddr_in6 {     
    uint8_t         sin6_len;       /* length of this struct */     
    sa_family_t     sin6_family;    /* AF_INET6 */     
    in_port_t       sin6_port;      /* transport layer port # */     
    uint32_t        sin6_flowinfo;  /* IPv6 flow information */     
    struct in6_addr sin6_addr;      /* IPv6 address */     
    uint32_t        sin6_scope_id;  /* set of interfaces for a scope */ 
}; 
</code></pre>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
sin6_scope_id: 32位整型,对于链路本地地址(link-local address),对于链路范围的sin6_addr,它可以用来标识指定的接口索引号.如果是站点范围的sin6_addr,则用来作为站点的标识符(站点本地地址已被抛弃).</p>
</blockquote>
<p>在使用link-local地址进行socket通信时,在构造目的地址时,需要制定该地址所对应的接口索引号.一般可以通过if_nametoindex函数将接口名转化为接口索引号.具体方式如下,</p>
<pre><code>int port = 1234;
int sk_fd;
int iff_index = 0;
char iff_name[100] = &quot;enp3s0&quot;;
char * ll_addr[100] = &quot;fe80::123:456:789&quot;;
struct sockaddr_in6 server_addr;

memset(&amp;server_addr,0,sizeof(structsockaddr_in6));
iff_index=if_nametoindex(iff_name);

server_addr.sin6_family=AF_INET6;
server_addr.sin6_port=htons(port);
server_addr.sin6_scope_id=iff_index;
inet_pton(AF_INET6, ll_addr, &amp;(server_addr.sin6_addr));

sk_fd=socket(AF_INET6, SOCK_STREAM, IPPROTO_TCP);
connect(sk_fd, (struct sockaddr *)&amp;server_addr, sizeof(struct sockaddr_in6));
</code></pre>
<h4 id="ipv4的dhclient守护进程持久化配置">IPv4的dhclient守护进程持久化配置</h4>
<h5 id="概述-4">概述</h5>
<p>通过NetworkManager服务来管理网络服务时,如果接口ifcfg-&lt;interface-name&gt;配置文件中配置了DHCP方式获得IP地址,则相应地NetworkManager服务会拉起dhclient守护进程来通过DHCP协议方式来从DHCP服务器获取IP地址.</p>
<p>dhclient提供了&quot;-1&quot;选项来决定dhclient进程在未获得DHCP服务响应时,是会不断持久化尝试请求地址还是会尝试时间超时后退出.针对IPv4的dhclient守护进程,可以在ifcfg-&lt;interface-name&gt;配置文件中设置PERSISTENT_DHCLIENT来决定是否设置IPv4的dhclient进程的持久化.</p>
<h5 id="约束限制-2">约束限制</h5>
<ol>
<li>当dhclient进程在运行中被杀死,network服务无法自动将其拉起,可靠性需要用户自己保障.</li>
<li>配置了持久化选项PERSISTENT_DHCLIENT,需要确保有相应的DHCP服务器.如果在拉起network时无可用DHCP服务器,dhclient进程不断尝试发送请求包但无回应,则会导致network服务卡死直到network服务超时失败.由于network服务在拉起多个网卡的IPv4 dhclient进程时,是通过串行的方式来拉起的.如果有网卡配置了持久化而DHCP服务器没有准备好,则会导致network服务在给该网卡获取IPv4地址超时卡死,进而导致后续网卡无法获得IPv4/IPv6地址.</li>
</ol>
<p>以上两种约束限制是特殊的应用场景,需要用户自己进行可靠性保障.</p>
<h5 id="ipv4-dhcp和ipv6-dhcpv6方式获取地址的配置差异">IPv4 DHCP和IPv6 DHCPv6方式获取地址的配置差异</h5>
<p>可以通过配置接口ifcfg-&lt;interface-name&gt;参数来分别实现IPv4和IPv6通过DHCP/DHCPv6协议来动态获取IP地址,具体配置说明如下;</p>
<pre><code>BOOTPROTO=none|bootp|dhcp
DHCPV6C=yes|no
PERSISTENT_DHCLIENT=yes|no|1|0
</code></pre>
<ul>
<li>
<p>BOOTPROTO: none表示静态配置IPv4地址,bootp|dhcp则会拉起DHCP dhclient来动态获取IPv4地址.</p>
</li>
<li>
<p>DHCPV6C: no表示静态配置IPv6地址,yes则会拉起DHCPv6 dhclient来动态获取IPv6地址.</p>
</li>
<li>
<p>PERSISTENT_DHCLIENT:no|0表示IPv4的dhclient进程配置为&quot;非持久化&quot;,当dhclient向DHCP服务器发送一次请求报文而无响应,则会间隔一段时间后退出,退出值为2.yes|1则表示IPv4的dhclient进程配置为&quot;持久化&quot;,dhclient会向DHCP服务器反复发送请求报文.<strong>如果没有配置PERSISTENT_DHCLIENT项,则IPv4的dhclient会默认设置为&quot;持久化&quot;</strong>.</p>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong><br>
PERSISTENT_DHCLIENT配置只针对IPv4生效,对IPv6相关dhclient -6进程不生效,IPv6默认不进行持久化配置.</p>
</blockquote>
</li>
</ul>
<h4 id="iproute相关命令配置ipv4与ipv6时的差异说明">iproute相关命令配置IPv4与IPv6时的差异说明</h4>
<h5 id="概述-5">概述</h5>
<p>由于IPv4和IPv6是两个不同的协议标准,iproute相关命令在使用方法上存在一定的差异.本章节主要梳理iproute包中用户经常使用到命令在IPv4和IPv6使用方面的差异,从而可以更好地指导用户使用iproute包中相关命令.</p>
<p>iproute相关命令均需要在root权限下运行.</p>
<h5 id="ipv6地址的生命周期">IPv6地址的生命周期</h5>
<p><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_table2076913233253"></a></p>
<table><thead align="left"><tr id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_row583762317252"><th class="cellrowborder" valign="top" width="22%" id="mcps1.1.3.1.1"><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p2837142362517"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p2837142362517"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p2837142362517"></a><strong id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_b1352931112514"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_b1352931112514"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_b1352931112514"></a>IPv6状态</strong></p>
</th>
<th class="cellrowborder" valign="top" width="78%" id="mcps1.1.3.1.2"><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p10837823172516"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p10837823172516"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p10837823172516"></a><strong id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_b105031361254"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_b105031361254"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_b105031361254"></a>解释</strong></p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_row178371023162518"><td class="cellrowborder" valign="top" width="22%" headers="mcps1.1.3.1.1 "><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p38371523152510"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p38371523152510"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p38371523152510"></a>tentative</p>
</td>
<td class="cellrowborder" valign="top" width="78%" headers="mcps1.1.3.1.2 "><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p198371423102517"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p198371423102517"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p198371423102517"></a>临时状态:刚添加地址还处于地址重复检测DAD过程</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_row58376230252"><td class="cellrowborder" valign="top" width="22%" headers="mcps1.1.3.1.1 "><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p683716233250"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p683716233250"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p683716233250"></a>preferred</p>
</td>
<td class="cellrowborder" valign="top" width="78%" headers="mcps1.1.3.1.2 "><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p19837122311259"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p19837122311259"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p19837122311259"></a>首选状态:完成DAD过程,没有收到相应的NA报文,表示该地址没有冲突.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_row883712382517"><td class="cellrowborder" valign="top" width="22%" headers="mcps1.1.3.1.1 "><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p88371623142516"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p88371623142516"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p88371623142516"></a>deprecated</p>
</td>
<td class="cellrowborder" valign="top" width="78%" headers="mcps1.1.3.1.2 "><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p38372023132510"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p38372023132510"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p38372023132510"></a>弃用状态:地址有一定的使用时限(valid_lft和preferred_lft),preferred_lft到期后地址会变化deprecated状态.</p>
<p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p4838102352510"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p4838102352510"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p4838102352510"></a>该状态下的地址不能用于创建新的连接,但是原有的连接可以继续使用.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_row16838152313252"><td class="cellrowborder" valign="top" width="22%" headers="mcps1.1.3.1.1 "><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p108383237254"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p108383237254"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p108383237254"></a>invalid</p>
</td>
<td class="cellrowborder" valign="top" width="78%" headers="mcps1.1.3.1.2 "><p id="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p19838132372518"><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p19838132372518"></a><a name="zh-cn_topic_0161841798_zh-cn_topic_0159090633_p19838132372518"></a>无效状态:使用时限超过preferred_lft一段时间后仍然没有成功进行租约续约,则valid_lft时间到后地址状态会被设置为invalid,表示该地址不可以再被使用.</p>
</td>
</tr>
</tbody>
</table>
<p>其它说明:</p>
<ul>
<li>preferred_lft:preferred lifetime,地址为首选状态的寿命,preferred_lft没有到期的地址可以用于正常通信使用,若有多个preferred地址则按照内核具体机制选择地址.</li>
<li>valid_lft: valid lifetime,地址有效的寿命,在[preferred_lft, valid_lft]时间段内该地址不能被用于新建连接,已经创建的连接继续有效.</li>
</ul>
<h5 id="ip-link-命令">ip link 命令</h5>
<p>命令:</p>
<pre><code>ip link set IFNAME mtu MTU
</code></pre>
<p>IPv6中PMTU的最小值为1280,如果mtu值设置小于1280则会导致IPv6地址丢失.其它设备无法ping通该IPv6地址.</p>
<h5 id="ip-addr命令">ip addr命令</h5>
<ol>
<li>
<p>命令:</p>
<pre><code>ip [-6] addr add IFADDR dev IFNAME
</code></pre>
<p>添加IPv6地址可以选择添加-6选项也可以不添加,ip addr命令会根据具体地址类型来判断是ipv4地址还是IPv6地址.</p>
<p>如果指定&quot;-6&quot;选项,但是IFADDR 是ipv4地址则会有错误返回.</p>
</li>
<li>
<p>命令:</p>
<pre><code>ip [-6] addr add IFADDR  dev IFNAME [home|nodad]
</code></pre>
<p>[home|nodad] 选项只针对IPv6地址有效.</p>
<ul>
<li>home:将该地址指定为RFC 6275中定义的家庭地址.(这是移动节点从家庭链路获取的地址, 是移动节点的永久地址,如果移动节点保持在相同的归属链路中,则各种实体之间的通信照常进行.)</li>
<li>nodad:配置该项(仅限IPv6)添加此地址时不执行重复地址检测DAD(RFC 4862).如果一台设备上多个接口通过nodad配置了多个相同的IPv6地址,则会按照接口顺序使用该IPv6地址.同一个接口上不能添加一个nodad一个非nodad的相同IPv6地址.因为两个地址是一样的,所以会报&quot;RTNETLINK answers: File exists&quot;.</li>
</ul>
</li>
<li>
<p>命令:</p>
<pre><code>ip [-6] addr del IFADDR dev IFNAME
</code></pre>
<p>删除IPv6地址可以选择添加-6选项也可以不添加,ip addr del命令会根据具体地址类型来判断是ipv4地址还是IPv6地址.</p>
</li>
<li>
<p>命令:</p>
<pre><code>ip [-6] addr show dev IFNAME [tentative|-tentative|deprecated|-deprecated|dadfailed|-dadfailed|temporary]
</code></pre>
<ul>
<li>不指定-6选项,则会同时打印IPv4和IPv6地址.指定-6选项则只打印IPv6地址.</li>
<li>[tentative|-tentative|deprecated|-deprecated|dadfailed|-dadfailed|temporary],这些选项只针对IPv6,可以根据IPv6地址状态对地址进行筛选查看.
<ol>
<li>tentative:(仅限IPv6)仅列出尚未通过重复地址检测的地址.</li>
<li>-tentative:(仅限IPv6)仅列出当前未处于重复地址检测过程中的地址.</li>
<li>deprecated:(仅限IPv6)仅列出已弃用的地址.</li>
<li>-deprecated:(仅限IPv6)仅列出未弃用的地址.</li>
<li>dadfailed:(仅限IPv6)仅列出重复地址检测失败的地址.</li>
<li>-dadfailed:(仅限IPv6)仅列出未重复地址检测失败的地址.</li>
<li>temporary:(仅限IPv6)仅列出临时地址</li>
</ol>
</li>
</ul>
</li>
</ol>
<h5 id="ip-route命令">ip route命令</h5>
<ol>
<li>
<p>命令:</p>
<pre><code>ip [-6] route add ROUTE [mtu lock MTU]
</code></pre>
<ul>
<li>
<p>-6选项:添加IPv6路由可以选择添加-6选项也可以不添加,ip route命令会根据具体地址类型来判断是IPv4地址还是IPv6地址.</p>
</li>
<li>
<p>mtu lock MTU:锁定路由的MTU值.如果不锁定MTU,则MTU的值则可能在PMTUD过程中被内核改变.如果锁定MTU,则不会尝试PMTUD,所有IPv4包都将不设置DF位发出,IPv6包则会按照MTU进行分段处理.</p>
</li>
</ul>
</li>
<li>
<p>命令:</p>
<pre><code>ip [-6] route del ROUTE
</code></pre>
<p>删除IPv6路由可以选择添加-6选项也可以不添加,ip route命令会根据具体地址类型来判断是IPv4地址还是IPv6地址.</p>
</li>
</ol>
<h5 id="ip-rule命令">ip rule命令</h5>
<ol>
<li>
<p>命令:</p>
<pre><code>ip [-6] rule list
</code></pre>
<p>-6选项:设置-6选项打印IPv6的策略路由,不设置-6选项打印IPv4的策略路由.所以需要根据具体协议类型来配置-6选项.</p>
</li>
<li>
<p>命令:</p>
<pre><code>ip [-6] rule [add|del] [from|to] ADDR table TABLE pref PREF
</code></pre>
<p>-6选项:IPv6相关的策略路由表项需要设置-6选项,否则会报错:&quot;Error: Invalid source address.&quot;.相应地,IPv4相关的策略路由表项不可以设置-6选项,否则会报错:&quot;Error: Invalid source address.&quot;.</p>
</li>
</ol>
<h4 id="networkmanager服务配置差异说明">NetworkManager服务配置差异说明</h4>
<h5 id="概述-6">概述</h5>
<p>NetworkManager服务使用ifup/ifdown的逻辑接口定义进行高级网络设置.其参数大多数都是在/etc/sysconfig/network和/etc/sysconfig/network-scripts/ifcfg-&lt;interface-name&gt;两个配置文件设置.前者为全局设置,后者为指定网卡的设置,当两者有冲突时,后者生效.</p>
<h5 id="配置差异说明">配置差异说明</h5>
<p>其中在/etc/sysconfig/network下的配置差异有:</p>
<p><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_table376122593014"></a></p>
<table><thead align="left"><tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row16343172516309"><th class="cellrowborder" valign="top" width="23.002300230023003%" id="mcps1.1.4.1.1"><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1934452593010"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1934452593010"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1934452593010"></a><strong id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b1059113443114"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b1059113443114"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b1059113443114"></a>IPv4</strong></p>
</th>
<th class="cellrowborder" valign="top" width="40.564056405640564%" id="mcps1.1.4.1.2"><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14344152593019"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14344152593019"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14344152593019"></a><strong id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b146313473111"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b146313473111"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b146313473111"></a>IPv6</strong></p>
</th>
<th class="cellrowborder" valign="top" width="36.43364336433643%" id="mcps1.1.4.1.3"><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p13344152533019"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p13344152533019"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p13344152533019"></a><strong id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b146511349319"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b146511349319"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b146511349319"></a>含义说明</strong></p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row934415256301"><td class="cellrowborder" valign="top" width="23.002300230023003%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p16344192543016"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p16344192543016"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p16344192543016"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.564056405640564%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1334482573012"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1334482573012"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1334482573012"></a>IPV6FORWARDING=yes|no</p>
</td>
<td class="cellrowborder" valign="top" width="36.43364336433643%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p934414251302"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p934414251302"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p934414251302"></a>IPv6转发,默认不转发.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row1344122517308"><td class="cellrowborder" valign="top" width="23.002300230023003%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9344152513303"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9344152513303"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9344152513303"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.564056405640564%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p123441025123013"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p123441025123013"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p123441025123013"></a>IPV6_AUTOCONF=yes|no</p>
</td>
<td class="cellrowborder" valign="top" width="36.43364336433643%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1134418258307"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1134418258307"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1134418258307"></a>IPv6转发打开是no,否则是yes.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row3344325173018"><td class="cellrowborder" valign="top" width="23.002300230023003%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9344725143019"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9344725143019"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9344725143019"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.564056405640564%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p2344225183011"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p2344225183011"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p2344225183011"></a>IPV6_ROUTER=yes|no</p>
</td>
<td class="cellrowborder" valign="top" width="36.43364336433643%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p113441425163010"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p113441425163010"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p113441425163010"></a>IPv6转发打开是yes,否则是no.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row173447253307"><td class="cellrowborder" valign="top" width="23.002300230023003%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p534417251308"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p534417251308"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p534417251308"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.564056405640564%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p8344132563010"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p8344132563010"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p8344132563010"></a>IPV6_AUTOTUNNEL=yes|no</p>
</td>
<td class="cellrowborder" valign="top" width="36.43364336433643%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1634492520303"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1634492520303"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1634492520303"></a>指定Tunnel为自动隧道模式,默认是no.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row93441325113014"><td class="cellrowborder" valign="top" width="23.002300230023003%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p5344192543017"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p5344192543017"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p5344192543017"></a>GATEWAY</p>
</td>
<td class="cellrowborder" valign="top" width="40.564056405640564%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p234515256308"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p234515256308"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p234515256308"></a>IPV6_DEFAULTGW=&lt;IPv6 address[%interface]&gt; (optional)</p>
</td>
<td class="cellrowborder" valign="top" width="36.43364336433643%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p103451125123015"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p103451125123015"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p103451125123015"></a>在IPv6中设置默认网关.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row1234519256301"><td class="cellrowborder" valign="top" width="23.002300230023003%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p334511251304"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p334511251304"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p334511251304"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.564056405640564%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9345122511309"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9345122511309"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9345122511309"></a>IPV6_DEFAULTDEV=&lt;interface&gt; (optional)</p>
</td>
<td class="cellrowborder" valign="top" width="36.43364336433643%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p153457255303"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p153457255303"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p153457255303"></a>指定默认转发的网卡.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row3345825183015"><td class="cellrowborder" valign="top" width="23.002300230023003%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1734518251306"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1734518251306"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1734518251306"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.564056405640564%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p0345325193012"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p0345325193012"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p0345325193012"></a>IPV6_RADVD_PIDFILE=&lt;pid-file&gt; (optional)</p>
</td>
<td class="cellrowborder" valign="top" width="36.43364336433643%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1034614253307"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1034614253307"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1034614253307"></a>默认ipv6_radvd_pid路径:/var/run/radvd/radvd.pid.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row15346162518300"><td class="cellrowborder" valign="top" width="23.002300230023003%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346125163015"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346125163015"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346125163015"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.564056405640564%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p13460257306"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p13460257306"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p13460257306"></a>IPV6_RADVD_TRIGGER_ACTION=startstop|reload|restart|SIGHUP (optional)</p>
</td>
<td class="cellrowborder" valign="top" width="36.43364336433643%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p19346132573014"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p19346132573014"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p19346132573014"></a>radvd默认触发动作.</p>
</td>
</tr>
</tbody>
</table>
<p>而在/etc/sysconfig/network-scripts/ifcfg-&lt;interface-name&gt;下的差异主要有:</p>
<p><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_table4128225193017"></a></p>
<table><thead align="left"><tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row034692593015"><th class="cellrowborder" valign="top" width="23.36%" id="mcps1.1.4.1.1"><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14346225143017"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14346225143017"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14346225143017"></a><strong id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b1766035020317"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b1766035020317"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b1766035020317"></a>IPv4</strong></p>
</th>
<th class="cellrowborder" valign="top" width="40.339999999999996%" id="mcps1.1.4.1.2"><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346132533012"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346132533012"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346132533012"></a><strong id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b3663175019313"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b3663175019313"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b3663175019313"></a>IPv6</strong></p>
</th>
<th class="cellrowborder" valign="top" width="36.3%" id="mcps1.1.4.1.3"><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p6346142517307"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p6346142517307"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p6346142517307"></a><strong id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b18664750163114"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b18664750163114"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_b18664750163114"></a>含义说明</strong></p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row63465257306"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346192519307"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346192519307"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p15346192519307"></a>IPADDRn</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p173461625163014"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p173461625163014"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p173461625163014"></a>IPV6ADDR=&lt;IPv6 address&gt;[/&lt;prefix length&gt;]</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p133461225173019"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p133461225173019"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p133461225173019"></a>ip地址.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row13347172513011"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p11347192511306"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p11347192511306"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p11347192511306"></a>PREFIXn</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p18347825153015"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p18347825153015"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p18347825153015"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1234752513017"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1234752513017"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1234752513017"></a>网络前缀,网络别名和ppp无效,优先级高于NETMASK.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row153471625183015"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p18347132511300"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p18347132511300"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p18347132511300"></a>NETMASKn</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p3347102511304"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p3347102511304"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p3347102511304"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p734772515307"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p734772515307"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p734772515307"></a>子网掩码,仅用于别名和ppp.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row193471625163016"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1534742593013"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1534742593013"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1534742593013"></a>GATEWAY</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9347132515300"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9347132515300"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9347132515300"></a>IPV6_DEFAULTGW=&lt;IPv6 address[%interface]&gt; (optional)</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14347132523011"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14347132523011"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p14347132523011"></a>默认网关.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row1434762573016"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p53471625203015"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p53471625203015"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p53471625203015"></a>MTU</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p203477255305"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p203477255305"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p203477255305"></a>IPV6_MTU=&lt;MTU of link&gt; (optional)</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p19348625183012"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p19348625183012"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p19348625183012"></a>默认MTU.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row5348225173015"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p203481925113014"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p203481925113014"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p203481925113014"></a>IPV4_FAILURE_FATAL=yes|no</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p73481225143013"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p73481225143013"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p73481225143013"></a>IPV6_FAILURE_FATAL</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1581816596383"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1581816596383"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1581816596383"></a>默认值是no.若设置为yes,dhclient失败ifup-eth会直接退出.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row1134822543015"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9348122573019"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9348122573019"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p9348122573019"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p734832513017"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p734832513017"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p734832513017"></a>IPV6_PRIVACY=rfc3041</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p10348152518301"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p10348152518301"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p10348152518301"></a>默认禁用.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row1134882573014"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p634802533014"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p634802533014"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p634802533014"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p33481925173012"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p33481925173012"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p33481925173012"></a>IPV6INIT=yes|no</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p113492254302"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p113492254302"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p113492254302"></a>默认开启IPv6.</p>
</td>
</tr>
<tr id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_row133491725173012"><td class="cellrowborder" valign="top" width="23.36%" headers="mcps1.1.4.1.1 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1834922518303"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1834922518303"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1834922518303"></a>NA</p>
</td>
<td class="cellrowborder" valign="top" width="40.339999999999996%" headers="mcps1.1.4.1.2 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1834982543011"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1834982543011"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p1834982543011"></a>IPV6FORWARDING=yes|no</p>
</td>
<td class="cellrowborder" valign="top" width="36.3%" headers="mcps1.1.4.1.3 "><p id="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p12349132516309"><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p12349132516309"></a><a name="zh-cn_topic_0161841799_zh-cn_topic_0159175469_p12349132516309"></a>默认关闭,已废弃.</p>
</td>
</tr>
</tbody>
</table>
<h3 id="faq">FAQ</h3>
<h4 id="iscsi-initiator-utils不支持登录fe80-ipv6地址">iscsi-initiator-utils不支持登录fe80 IPv6地址</h4>
<h5 id="问题现象">问题现象</h5>
<p>客户端通过IPv6登录iscsi服务端时,使用如&quot;iscsiadm -m node -p ipv6address -l&quot;的命令格式登录,如果是全局地址(global address),直接替换将命令范例中的&quot;ipv6address&quot;替换为全局地址即可;但如果是链路本地地址(link-local address,fe80开头的IPv6地址)则无法使用,因为iscsi-initiator-utils目前机制还不支持用链路本地地址(link-local address)地址登录iscsi服务端.</p>
<h5 id="原因分析">原因分析</h5>
<p>如果使用格式如&quot;iscsiadm -m node -p fe80::xxxx -l&quot;登录,会登录超时返回,这是因为使用链路本地地址必须指定接口,否则使用iscsi_io_tcp_connect函数调用connect函数会失败,并且产生标准错误码22.</p>
<p>如果使用格式如&quot;iscsiadm -m node -p fe80::xxxx%enp3s0 -l&quot;登录时,iscsi_addr_match函数会将地址&quot;fe80::xxxx%enp3s0&quot;与服务端返回的node信息中的地址&quot;fe80::xxxx&quot;对比,对比结果不匹配,导致登录失败.</p>
<p>因此,<strong>iscsi-initiator-utils目前机制还不支持用链路本地地址(link-local address)登录iscsi服务端</strong>.</p>
<h4 id="网卡down掉之后ipv6地址丢失">网卡down掉之后,IPv6地址丢失</h4>
<h5 id="问题现象-2">问题现象</h5>
<p>通过ip link down+up网卡或ifconfig down+up网卡命令,将网卡down掉之后再上线,查看网卡上配置的ip地址,发现ipv4地址不丢失,而配置的IPv6地址丢失.</p>
<h5 id="原因分析-2">原因分析</h5>
<p>内核中的处理逻辑为如果网卡设置为down状态,会清空所有IPv4及IPv6地址,将网卡重新up之后,ipv4地址自动恢复,网卡上自动配置的IPv6链路本地地址也会恢复,但是其他IPv6地址默认会丢失.如果需要保留这些IPv6地址,可以通过&quot;sysctl -w net.ipv6.conf.&lt;网卡名&gt;.keep_addr_on_down=1&quot;来实现.</p>
<h4 id="bond口已具有多个ipv6地址时添加或删除ipv6地址耗时过久">bond口已具有多个IPv6地址时,添加或删除IPv6地址耗时过久</h4>
<h5 id="问题现象-3">问题现象</h5>
<p>下列方式配置或删除(包括flush)IPv6地址方式,X为动态变化的低16位,并且配置在bond口时,耗时会随已配置的IPv6地址数量成数倍增加.例如由4个物理网卡组成的bond口添加IPv6地址时,单线程添加删除3000 IPv6地址均需大概5分钟,而普通物理网卡耗时在10秒内.</p>
<pre><code>ip a add/del 192:168::18:X/64 dev DEVICE
</code></pre>
<h5 id="原因分析-3">原因分析</h5>
<p>bond口在添加IPv6地址时,会生成IPv6组播地址,并进行同步到所有的物理网卡上,此耗时会随IPv6数量增加而增加,导致耗时过长.</p>
<h5 id="解决方法">解决方法</h5>
<p>IPv6的组播地址是由IPv6地址的低24位与33-33-ff组合生成,组播地址过多会导致添加删除耗时增加,如果生成的组播地址为少量,耗时不会受此影响.</p>
<p>建议添加IPv6地址时,可保持低24位一致,保持高位变动,单网卡中仅需一个网段的一个地址即可与外部正常通信,此配置更符合常规使用.</p>
<h4 id="rsyslog在ipv4和ipv6混合使用场景中日志传输延迟">Rsyslog在IPv4和IPv6混合使用场景中日志传输延迟</h4>
<h5 id="问题现象-4">问题现象</h5>
<p>rsyslog客户端配置文件同时配置IPv4和IPv6地址,且端口配置相同的情况下,服务端收集log时会概率性出现日志打印延迟.</p>
<h5 id="原因分析-4">原因分析</h5>
<p>延迟是因为rsyslog内部存在缓冲队列机制,默认情况下需要缓冲区队列达到一定数量才会写入文件.</p>
<h5 id="解决方法-2">解决方法</h5>
<p>可在root权限下通过配置Direct模式,关闭缓冲队列机制解决该问题.在rsyslog远程传输服务端的/etc/rsyslog.d目录下新增的远程传输配置文件中,最开头增加如下配置:</p>
<pre><code>$ActionQueueType Direct
$MainMsgQueueType Direct
</code></pre>
<blockquote>
<p><img src="./public_sys-resources/icon-note.gif" alt="" loading="lazy"> <strong>说明:</strong></p>
<ul>
<li>Direct模式减少队列大小为1,所以在队列中会保留1条日志到下次日志打印;</li>
<li>Direct模式会降低服务器端的rsyslog性能.</li>
</ul>
</blockquote>

            </div>
          </article>
        </div>
        <div class="paper" data-aos="fade-in">
          
            <div class="next-post">
              <div class="next">
                下一篇
              </div>
              <a href="https://zhangyiming748.github.io/post/ntp_server/">
                <h3 class="post-title">
                  NTP服务器地址
                </h3>
              </a>
            </div>
          
        </div>
        
          

          
            <div class="paper" data-aos="fade-in">
              <div id="disqus_thread"></div>
            </div>
          
        
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img src="https://zhangyiming748.github.io/images/avatar.png?v=1745160053425" class="no-responsive avatar">
    <div class="text-muted">子非鱼,安知鱼之乐?
子非我,安知我不知鱼之乐?</div>
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      最新文章
    </div>
    <div class="row">
      <ul>
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/MacOS_unable_to_connect_requires_authenticated_Wi-Fi_solution/">macOS无法连接需要通过认证的Wi-Fi解决办法</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/simple_docker_image/">极简docker镜像</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/Sell_Online_Course_Video_One_Look_Fake_Verification/">卖网课视频一眼假验证</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/android_package_name/">部分安卓程序包名和软件名对应表</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/move_docker_volume/">迁移 docker volume</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/docker_volume_movable/">docker volume 迁移</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/termux_use_bilibili/">termux关于bilibili的备份</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/github_in_everywhere/">在任何地方引用Github的贡献日历图</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/docker_set_daemon_use_proxy/">docker的daemon如何设置拉取镜像的时候走代理</a>
            </li>
          
        
          
            <li>
              <a href="https://zhangyiming748.github.io/post/rename_Downloads_on_windows/">转载 : 解决下载文件夹变为`Downloads`</a>
            </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      标签列表
    </div>
    <div class="row">
      
        <a href="https://zhangyiming748.github.io/tag/wmIzFoEIP/" class="badge warning">
          macOS
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/1QbocojG3/" class="badge warning">
          AI
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/OIVRELVRC/" class="badge ">
          Docker
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/KI4qLtXEOu/" class="badge secondary">
          打假卖课
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/tE7JyHymUI/" class="badge success">
          Android
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/tPncTIGxnb/" class="badge ">
          bash
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/9S2Hbs5aF/" class="badge success">
          Termux
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/y_Kw8o5PB/" class="badge secondary">
          GitHub
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/A_KFuUKds/" class="badge secondary">
          Proxy
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/m-fbGUfZt/" class="badge success">
          Windows
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/vYkbFqA51/" class="badge success">
          Jetbrains
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/oCK_ZlHhX/" class="badge success">
          openKylin
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/vdcblAPcj/" class="badge secondary">
          adb
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/whd1tmbG7/" class="badge success">
          Linux
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/1CFQNs3S00/" class="badge warning">
          shell
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/bCXMDy8-U/" class="badge secondary">
          ffmpeg
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/qzc1SQq3q/" class="badge secondary">
          nVidia
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/7Ibnloi-i/" class="badge secondary">
          WSL
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/X945mIRqj/" class="badge secondary">
          ssh
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/QrQiV5P0S/" class="badge success">
          python
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/E2-gGJkDg/" class="badge warning">
          Golang
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/85HirN3QA/" class="badge warning">
          收费教程
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/SF9usuVqj/" class="badge ">
          fedora
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/Sf_ODGuJI/" class="badge ">
          Gitea
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/PMvg7E-Fr/" class="badge secondary">
          双系统
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/yitXMMZ8s/" class="badge secondary">
          xiaomi
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/NOMqGtkmio/" class="badge success">
          Magisk
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/uSPmjvKQ6/" class="badge secondary">
          vim
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/O52S4xod7/" class="badge warning">
          nano
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/y2nV8ofCl/" class="badge warning">
          knowledge
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/etvDZTSvp/" class="badge warning">
          nginx
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/CnfRrFASW/" class="badge secondary">
          Git
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/svHvfBDw2/" class="badge secondary">
          UOS
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/Qs-o9CgUP/" class="badge secondary">
          五分钟已经很棒了
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/AWiWiIeFs/" class="badge warning">
          Deepin
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/fGCndQxpp/" class="badge ">
          Raspberry
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/pHreM0cJf/" class="badge secondary">
          欧卡2
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/MqthCZEuF/" class="badge secondary">
          HomeBrew
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/9aViM641i/" class="badge success">
          MySql
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/rMjOn_-Vr/" class="badge secondary">
          tencent
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/YHDkAytMg/" class="badge secondary">
          oracle
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/Oo5pjqygD/" class="badge success">
          VirtualBox
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/XdGtzoLPj/" class="badge ">
          ChatGPT
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/KWd48Zkke/" class="badge success">
          npm
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/FrlwPAtkRd/" class="badge secondary">
          Nodejs
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/4u1IqSlDf/" class="badge secondary">
          openWrt
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/Ps_QL1RK-/" class="badge secondary">
          Samba
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/auU862seE/" class="badge ">
          小米
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/bZrOQ_cvHC/" class="badge success">
          电视盒子
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/9R2pw-kMi/" class="badge secondary">
          AndroidTV
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/DLTs-6kxd/" class="badge ">
          COD
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/PNLCUL_aG/" class="badge secondary">
          Game
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/kONTQ9X-u/" class="badge success">
          黑道圣徒
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/3ge3wV01e/" class="badge secondary">
          Steam
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/GYLNJVSdF/" class="badge success">
          vmware
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/1O2FuszwC/" class="badge secondary">
          snap
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/mWurRYeSd/" class="badge ">
          UWP
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/vU03EjBoU/" class="badge secondary">
          跨平台
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/8M3Y_WiPK/" class="badge ">
          Ubuntu
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/vh0_cV9V9/" class="badge secondary">
          RDP
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/RlEfsxIRy/" class="badge secondary">
          UTM
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/2Li1q3KkK/" class="badge secondary">
          WineHq
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/akbUFpHWM/" class="badge secondary">
          xfce
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/gHhqkzUH9/" class="badge secondary">
          ventoy
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/J2hqqgy1q/" class="badge ">
          gparted
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/pmLBkvrEV/" class="badge warning">
          openEuler
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/W7ZvoH8Ya/" class="badge secondary">
          华为
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/Lw5WL9LfT/" class="badge secondary">
          SaintsRowTheThird
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/tOjoRhGkq/" class="badge success">
          Gitlab
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/S5LhsRFML/" class="badge secondary">
          AppImage
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/eoLpx9JG3/" class="badge secondary">
          NTP
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/gAD6snp8U/" class="badge ">
          NieR
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/7NJFDXwY-/" class="badge success">
          Markdown
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/oOmosMagH/" class="badge warning">
          网络
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/8jNGiW0SY/" class="badge success">
          GTA
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/HhYYX0R-k/" class="badge ">
          youtube
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/WU7bMNjDy/" class="badge secondary">
          office
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/HlNHNYrCz/" class="badge ">
          体育
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/9_I_W5FOy/" class="badge secondary">
          bat
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/j49MIdPra/" class="badge success">
          Androidx86
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/cBDrzFROX/" class="badge secondary">
          geek
        </a>
      
        <a href="https://zhangyiming748.github.io/tag/kjzWt_8WM/" class="badge warning">
          Gridea
        </a>
      
    </div>
  </div>
  <div class="paper">
    Powered by <a href="https://github.com/zhangyiming748" target="_blank">Gridea</a> | <a class="rss" href="https://zhangyiming748.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>


    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

</script>



  

  
    <script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>
    <script>

    var options = {
      shortname: 'zhangyiming748-github-io',
      apikey: 'nmwRR2QnDaSkyLUKsaGV3rCjyY5HsirUNUQA0YQHN8369jhrR8lFqsVmrPuYeadq',
    }
    if ('') {
      options.api = ''
    }
    var dsqjs = new DisqusJS(options)

    </script>
  




  </body>
</html>
